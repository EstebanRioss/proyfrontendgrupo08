<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body p-4">

          <h2 class="card-title text-center mb-4">Mi Perfil</h2>

          <div *ngIf="usuario; else loading">
            <fieldset disabled>
              <div class="mb-3">
                <label for="email" class="form-label fw-bold">Email</label>
                <input type="email" id="email" class="form-control" [value]="usuario.email">
                <div class="form-text">Tu email es tu identificador y no puede ser modificado.</div>
              </div>
              <div class="mb-4">
                <label for="rol" class="form-label fw-bold">Rol</label>
                <input type="text" id="rol" class="form-control text-capitalize" [value]="usuario.rol">
              </div>
            </fieldset>

            <hr class="my-4">

            <form [formGroup]="updateForm" (ngSubmit)="onSubmit()" novalidate>
              <h4 class="mb-3">Editar mis datos</h4>

              <div class="mb-3">
                <label for="nombre" class="form-label">Nombre</label>
                <input type="text" id="nombre" formControlName="nombre" class="form-control"
                       [ngClass]="{ 'is-invalid': nombre?.invalid && nombre?.touched }">
                <div *ngIf="nombre?.invalid && nombre?.touched" class="invalid-feedback">
                  <div *ngIf="nombre?.errors?.['required']">El nombre es requerido.</div>
                  <div *ngIf="nombre?.errors?.['minlength']">Debe tener al menos 2 caracteres.</div>
                </div>
              </div>

              <div class="mb-3">
                <label for="apellido" class="form-label">Apellido</label>
                <input type="text" id="apellido" formControlName="apellido" class="form-control"
                       [ngClass]="{ 'is-invalid': apellido?.invalid && apellido?.touched }">
                <div *ngIf="apellido?.invalid && apellido?.touched" class="invalid-feedback">
                  <div *ngIf="apellido?.errors?.['required']">El apellido es requerido.</div>
                  <div *ngIf="apellido?.errors?.['minlength']">Debe tener al menos 2 caracteres.</div>
                </div>
              </div>

              <div class="mb-3">
                <label for="telefono" class="form-label">Teléfono</label>
                <input type="tel" id="telefono" formControlName="telefono" class="form-control"
                       placeholder="Ej: 1123456789 (opcional)"
                       [ngClass]="{ 'is-invalid': telefono?.invalid && telefono?.touched }">
                <div *ngIf="telefono?.invalid && telefono?.touched" class="invalid-feedback">
                  <div *ngIf="telefono?.errors?.['pattern']">Ingresa un número de teléfono válido.</div>
                </div>
              </div>
              
              <div *ngIf="mensajeExito" class="alert alert-success mt-3">{{ mensajeExito }}</div>
              <div *ngIf="mensajeError" class="alert alert-danger mt-3">{{ mensajeError }}</div>

              <div class="d-grid mt-4">
                <button type="submit" class="btn btn-primary" [disabled]="updateForm.invalid || isLoading">
                  <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                  {{ isLoading ? 'Guardando...' : 'Guardar Cambios' }}
                </button>
              </div>

            </form>
          </div>

          <ng-template #loading>
            <div class="text-center p-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
              <p class="mt-2 text-muted">Cargando tus datos...</p>
            </div>
          </ng-template>

        </div>
      </div>
    </div>
  </div>
</div>